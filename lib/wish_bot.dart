import 'dart:math';

import 'package:logger/logger.dart';
import 'package:teledart/model.dart';
import 'package:teledart/teledart.dart';
import 'package:teledart/telegram.dart';
import 'package:wish_bot/api.dart';
import 'package:wish_bot/config.dart';

class Bot with Api {
  final TeleDart _teleDart;
  Bot(this._teleDart);
  static Future<Bot> get init async {
    final username = (await Telegram(apiKey).getMe()).username;
    var tel = TeleDart(apiKey, Event(username ?? ""));
    tel.start();
    var bot = Bot(tel);
    await bot.initApi();
    return bot;
  }

  void _initCommand(String command, void Function(TeleDartMessage msg) action) {
    _teleDart.onCommand(command).listen((event) => action(event));
  }

  void _initMessage(String msg, void Function(TeleDartMessage msg) action) {
    _teleDart.onMessage(keyword: msg).listen((event) => action(event));
  }

  void start() async {
    _initCommand("start", (msg) async {
      await msg.reply(
        "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –¥–æ—Å—Ç–ø—É–Ω—ã:\n\n /random",
      );
    });
    _teleDart.onCallbackQuery().listen((event) {
      Logger().d(event.data);
    });
  }

  void randomGift() {
    _initCommand("random", (msg) {
      var random = titleNg.split("\n");
      var re = Random.secure().nextInt(random.length);
      msg.reply(random[re]);
    });
  }
}

const titleNg = '''
–° –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –≥–æ–¥–æ–º! 
–° –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –≥–æ–¥–æ–º, –∂–µ–ª–∞—é —á—Ç–æ–±—ã —ç—Ç–æ—Ç –≥–æ–¥ –æ–∫–∞–∑–∞–ª—Å—è —Å –º–µ–Ω—å—à–∏–º–∏ –ø–æ—Ç—Ä—è—Å–µ–Ω–∏—è–º–∏, —á–µ–º —ç—Ç–æ—Ç!
–° –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –≥–æ–¥–æ–º, –∂–µ–ª–∞—é —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ!
–ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –≥–æ–¥–æ–º! –í—Å–µ–≥–æ –Ω–∞–∏–ª—É—á—à–µ–≥–æ! 
–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º, –∂–µ–ª–∞—é —É—Å–ø–µ—Ö–æ–≤ –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É!! 
 –° –¥–Ω–µ–º —É—á–∏—Ç–µ–ª—è! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤—Å–µ, —á—Ç–æ –í—ã –¥–ª—è –º–µ–Ω—è —Å–¥–µ–ª–∞–ª–∏
 –° –¥–Ω–µ–º —É—á–∏—Ç–µ–ª—è! –ë–ª–∞–≥–æ–¥–∞—Ä—é –í–∞—Å –∑–∞ –≤—Å–µ
 –° –¥–Ω–µ–º —É—á–∏—Ç–µ–ª—è! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤—Å–µ –í–∞—à–∏ —Å—Ç–∞—Ä–∞–Ω–∏—è
 –° –¥–Ω–µ–º —É—á–∏—Ç–µ–ª—è! 
 –° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º 8 –º–∞—Ä—Ç–∞
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å 8 –º–∞—Ä—Ç–∞ –∏ –∂–µ–ª–∞—é —Å–≤–µ—Ç–∏—Ç—å—Å—è –∏ —Å–≤–µ—Ç–∏—Ç—å
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —ç—Ç–∏–º –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º –¥–Ω–µ–º
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å 8 –º–∞—Ä—Ç–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –º–∏—Ä –ø—Ä–µ–∫—Ä–∞—Å–Ω–µ–µ
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —Ç–µ–º, —á—Ç–æ –µ—â–µ –Ω–∞ –æ–¥–∏–Ω –≥–æ–¥ –ø–æ—Å—Ç–∞—Ä–µ–ª
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —Ç–µ–º, —á—Ç–æ –µ—â–µ –Ω–∞ –æ–¥–∏–Ω –≥–æ–¥ –ø–æ—Å—Ç–∞—Ä–µ–ª–∞
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è. –¢–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è-–º–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è üéâ 
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è. –ñ–µ–ª–∞—é —Å—á–∞—Å—Ç—å—è –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è. –ñ–µ–ª–∞—é –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ –∏ —Å—á–∞—Å—Ç—å—è 
 –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è. –ñ–µ–ª–∞—é –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —Å—á–∞—Å—Ç—å—è –∏ –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è 
 –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞—é –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π 
 –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞—é —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏–ª —Å—á–∞—Å—Ç—å–µ –∏ —Ä–∞–¥–æ—Å—Ç—å ''';
